# TRS フットスイッチ → USB MIDI デバイス 要件定義

## 概要
TRS 接続の外部フットスイッチ (最大 2 接点) を USB MIDI デバイスとして認識させる。  
スイッチ操作に応じて任意の MIDI メッセージ (CC / PC など) を送信可能とする。  
PC 側からの SysEx 設定メッセージにより、各スイッチの挙動を変更できる。  
設定は本体内に保存され、再起動後も有効とする。

---

## ハードウェア要件
- マイコン: Raspberry Pi Pico (RP2040)
- 入力: TRS ジャック (最大 2 接点: Tip, Ring)
- 出力: USB MIDI デバイス (クラスコンプライアント)
- 電源: USB バスパワー

---

## 基本機能
1. **スイッチ検出**
   - 押下 / 離上を確実に検出する (デバウンス処理あり)  
   - 2 接点 (Tip, Ring) を独立して扱う

2. **MIDI 出力**
   - 各スイッチに対して、押下時 / 離上時 に個別の MIDI メッセージを割り当て可能
   - 対応メッセージ:  
     - CC (Control Change)  
     - PC (Program Change)  
     - 可能なら Note On/Off も将来対応 (拡張性のため)

3. **SysEx 設定**
   - PC から SysEx メッセージを受信し、各スイッチの動作設定を変更可能
   - 設定内容はフラッシュメモリに保存
   - 再起動後も設定を保持

---

## SysEx 仕様 (暫定)

### メーカー ID
- 非商用用途のため **非営利 ID: `00 7D`** を使用

### メッセージ構造

```
F0 00 7D <デバイスID> <コマンド> <データ...> F7
```


- `<デバイスID>`: 固定値 01 (将来の拡張用)
- `<コマンド>`: 設定種別
  - `01`: スイッチ設定
- `<データ>`:  
  - スイッチ番号 (1 or 2)  
  - イベント種別 (0=押下, 1=離上)  
  - メッセージタイプ (0=CC, 1=PC, 2=Note)  
  - MIDI チャンネル (0–15)  
  - パラメータ1 (CC番号 or Note番号)  
  - パラメータ2 (値: CC値 or Note Velocity、PCなら不要)

### 例: スイッチ1押下 → CC#64, 値127 を送信
```
F0 00 7D 01 01 00 00 00 40 7F F7
```

